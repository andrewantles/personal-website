# Blog Build System Plan

## Goals

1. Python build script that converts markdown posts in `/posts/` to HTML pages
   in `/pages/`
2. Auto-generated `/pages/blog.html` landing page listing all posts as
   full-width horizontal tiles, latest first
3. Uses `python-markdown` library for md-to-html conversion
4. Integrates with the component injection system described in `no-js.md`

## What We're Building

```
posts/                                  # You write markdown here
  2024-03-01-google-ml-crash-course.md
  2026-01-18-security-program-week-1.md
  2026-01-25-security-program-week-2.md
  2026-02-01-security-program-week-3.md
  2026-01-25-security-program-week-2-files/   # Post images (existing)
  2026-02-01-security-program-week-3-files/   # Post images (existing)

src/
  templates/
    post.html                           # HTML wrapper for individual posts
    blog.html                           # Template for the blog listing page
  components/
    header.html
    navbar.html
    footer.html

pages/                                  # Build output
  blog.html                             # Auto-generated listing page
  blog/
    2024-03-01-google-ml-crash-course.html
    2026-01-18-security-program-week-1.html
  ...

build.py                                # The build script
```

## Frontmatter: A Gap to Address

Your current markdown files have no metadata header. The build script needs at
least a title and date for each post (to display on the listing page tiles).
Two options:

### Option A: YAML Frontmatter (Recommended)

Add a small metadata block to the top of each markdown file:

```markdown
---
title: "Security Program - Week 3"
date: 2026-02-01
summary: "Booting a Raspberry Pi 4 from USB 3.0 for the home security lab."
---

# Project Mission - north star
...rest of your post...
```

- `python-markdown` has a built-in `meta` extension that parses this
- The `summary` field is optional but gives you control over what shows on the
  tile (vs auto-extracting the first paragraph)
- This is the standard convention across nearly all blog/markdown systems

### Option B: Parse From Filename + Content

- Date from filename: `2026-02-01-security-program-week-3.md` → `2026-02-01`
- Title from first `# heading` in the file
- Summary from first paragraph

This avoids changing your existing files but is more fragile and gives you less
control.

**Recommendation:** Option A. It's 3-4 lines per file, one-time effort, and
gives you explicit control over how each post appears on the listing page.

## Post Template (`src/templates/post.html`)

Individual blog posts get wrapped in this template during build:

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>{{ title }} - AndrewAntles.Net</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../public/style.css">
  </head>
  <body>
    <!-- component:header -->
    <!-- component:navbar -->

    <main class="page-content">
      <article class="blog-post">
        <time datetime="{{ date }}">{{ date_display }}</time>
        {{ content }}
      </article>
    </main>

    <!-- component:footer -->
  </body>
</html>
```

The build script reads this template, replaces `{{ title }}`, `{{ date }}`,
`{{ content }}`, etc., then runs it through the component injector from
`no-js.md`.

## Blog Listing Page (`src/templates/blog.html`)

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Blog - AndrewAntles.Net</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../public/style.css">
  </head>
  <body>
    <!-- component:header -->
    <!-- component:navbar -->

    <main class="page-content blog-listing">
      <h2>Blog</h2>
      {{ post_tiles }}
    </main>

    <!-- component:footer -->
  </body>
</html>
```

Each tile is generated by the build script:

```html
<a href="./2026-02-01-security-program-week-3.html" class="post-tile">
  <article>
    <time datetime="2026-02-01">February 1, 2026</time>
    <h3>Security Program - Week 3</h3>
    <p>Booting a Raspberry Pi 4 from USB 3.0 for the home security lab.</p>
  </article>
</a>
```

### Tile Layout & Styling

Full viewport width, stacked vertically, latest first. CSS:

```css
.blog-listing {
  max-width: 720px;  /* matches existing page-content */
}

.post-tile {
  display: block;
  padding: 1.25rem;
  margin-bottom: 1rem;
  background-color: #f0f0f0;
  border-radius: 4px;
  text-decoration: none;
  color: inherit;
  transition: background-color 0.15s;
}

.post-tile:hover,
.post-tile:focus {
  background-color: #e4e4e4;
}

.post-tile time {
  font-size: 0.85em;
  color: #666;
}

.post-tile h3 {
  margin: 0.25em 0;
}

.post-tile p {
  margin: 0;
  color: #555;
}
```

## Build Script Additions (`build.py`)

The build script from `no-js.md` gets extended with:

```python
import markdown  # python-markdown

def parse_frontmatter(text):
    """Extract YAML frontmatter and body from a markdown file."""
    if text.startswith("---"):
        _, fm, body = text.split("---", 2)
        meta = {}
        for line in fm.strip().splitlines():
            key, _, value = line.partition(":")
            meta[key.strip()] = value.strip().strip('"')
        return meta, body.strip()
    return {}, text

def build_posts():
    """Convert markdown posts to HTML pages and generate listing."""
    posts_dir = Path("posts")
    template = (SRC / "templates" / "post.html").read_text()
    components = load_components()
    posts_meta = []

    for md_file in sorted(posts_dir.glob("*.md"), reverse=True):
        raw = md_file.read_text()
        meta, body = parse_frontmatter(raw)

        # Convert markdown to HTML
        html_content = markdown.markdown(body, extensions=["fenced_code"])

        # Fill in the post template
        page = template
        page = page.replace("{{ title }}", meta.get("title", md_file.stem))
        page = page.replace("{{ date }}", meta.get("date", ""))
        page = page.replace("{{ date_display }}", format_date(meta.get("date", "")))
        page = page.replace("{{ content }}", html_content)

        # Inject shared components (header, navbar, footer)
        page = inject_components(page, components)

        # Write to pages/
        dest = Path("pages") / (md_file.stem + ".html")
        dest.write_text(page)

        posts_meta.append({
            "title": meta.get("title", md_file.stem),
            "date": meta.get("date", ""),
            "summary": meta.get("summary", ""),
            "slug": md_file.stem,
        })

    # Generate blog listing page
    build_blog_listing(posts_meta, components)
```

## Image Handling: A Gap to Address

Your posts reference images in subdirectories like:

```
posts/2026-02-01-security-program-week-3-files/screenshot.png
```

When the markdown converts to HTML at `pages/2026-02-01-...html`, relative
image paths need to resolve correctly. Two options:

### Option A: Keep images in `/posts/`, use relative paths

Markdown images like `![alt](./2026-02-01-security-program-week-3-files/screenshot.png)`
become `../posts/2026-02-01-security-program-week-3-files/screenshot.png` in
the built HTML. The build script rewrites paths during conversion.

### Option B: Move images to `/public/post-images/`

More conventional, but requires moving existing files and updating references.

**Recommendation:** Option A for now. Keep images next to their posts in
`/posts/`. The build script rewrites the relative paths. Lower friction, and
images stay co-located with the content they belong to.

## The Existing Google ML Post

The file `posts/2024-03-01-google-ml-crash-course.md` contains raw HTML, not
markdown. `python-markdown` passes HTML through untouched, so this will
work without changes. However, to use frontmatter and get it on the listing
page, you'd add the `---` block to the top of that file too.

There's also a manually-created HTML version at
`pages/blog-one-post-google-machine-learning.html`. Once the build system
handles this post, that manual file can be removed (or kept as a redirect).

## What `blog-menu.js` Becomes

The current `blog-menu.js` hardcodes a single post link. With this build
system, blog navigation is handled by the listing page (`blog.html`) itself.
The navbar links to `blog.html`, and from there visitors click into individual
posts. `blog-menu.js` can be removed.

If you want per-post navigation (prev/next links), the build script can inject
those since it knows the post order at build time.

## Migration Steps

1. `pip install markdown` (the `python-markdown` library)
2. Add YAML frontmatter to each markdown file in `/posts/`
3. Create `src/templates/post.html` and `src/templates/blog.html`
4. Extend `build.py` with `build_posts()` and `build_blog_listing()`
5. Add blog tile CSS to `public/style.css`
6. Run `python build.py` - verify generated pages look correct
7. Remove `pages/blog-one-post-google-machine-learning.html` (replaced by
   build output)
8. Remove `components/blog-menu.js` (replaced by blog listing page)
9. Commit and push

## Gaps & Questions Identified

1. **Frontmatter:** Your markdown files need metadata. See "Frontmatter"
   section above for the recommended approach.

2. **Image paths:** Markdown image references need path rewriting when the
   HTML lands in `/pages/`. See "Image Handling" section above.

3. **The Google ML post:** It's raw HTML in a `.md` file. Works with
   `python-markdown` but needs frontmatter added for the listing page.

4. **Tile content:** What do you want on each tile beyond title and date?
   The plan assumes: date, title, and a short summary (from frontmatter).
   Let me know if you want something different (e.g., estimated read time,
   tags/categories, a thumbnail image).

5. **Post URL scheme:** The plan uses the markdown filename as the HTML
   filename (`2026-02-01-security-program-week-3.md` →
   `2026-02-01-security-program-week-3.html`). This keeps URLs stable and
   predictable. The existing Google ML post would change URL from
   `blog-one-post-google-machine-learning.html` to
   `2024-03-01-google-ml-crash-course.html`.

6. **Integration with no-js.md:** This plan extends the build script from
   `no-js.md`. Both component injection and post building happen in the same
   `build.py`. Should we implement them together, or blog posts first?

7. **python-markdown extensions:** Beyond `fenced_code` (for code blocks),
   do you want `tables`, `toc` (table of contents), or `codehilite` (syntax
   highlighting)? These are all built-in extensions, zero extra dependencies.
